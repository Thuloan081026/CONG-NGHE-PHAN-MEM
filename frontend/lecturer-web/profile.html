<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>H·ªì s∆° - Gi·∫£ng vi√™n | SMD</title>
  <link rel="icon" href="assets/images/favicon.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    :root{--bg:#eef3ff;--card:#fff;--primary:#5b6bf3;--muted:#6b7280}
    body{background:linear-gradient(180deg,var(--bg),#f7f9ff);font-family:Inter,system-ui,Arial;margin:0}
    .page{max-width:1200px;margin:24px auto;padding:0 20px}
    .profile-header{display:flex;gap:24px;align-items:center;padding:26px;border-radius:12px;background:linear-gradient(90deg,#fff,#fbfdff);box-shadow:0 6px 20px rgba(20,30,80,0.04)}
    .avatar{width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg,var(--primary),#7c5dfc);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:48px;border:6px solid var(--card)}
    .profile-info h1{margin:0;font-size:28px}
    .profile-info .meta{color:var(--muted);margin-top:6px}
    .profile-actions{margin-left:auto;text-align:right}
    .btn-edit{background:#0b67ff;color:#fff;border-radius:8px;padding:10px 14px;border:none}
    .btn-public{background:#eef2ff;border:none;color:#374151;border-radius:8px;padding:8px 12px;margin-top:8px}

    .card-panel{background:var(--card);border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(30,40,80,0.04)}
    .section-title{font-weight:600;margin-bottom:12px}
    .course-pill{display:inline-block;background:#f3f6fb;padding:12px 18px;border-radius:8px;margin-right:12px;margin-bottom:8px;color:#334155}

    .activity-item{display:flex;gap:12px;padding:14px 0;border-bottom:1px solid #f1f5f9}
    .activity-item:last-child{border-bottom:0}

    .progress-small{height:10px;border-radius:8px}
    .side-btn{width:100%;text-align:center;border-radius:8px;padding:10px}

    @media (max-width:991px){.profile-header{flex-direction:column;align-items:flex-start}.profile-actions{width:100%;text-align:left}}
  </style>
</head>
<body>
  <div class="page">
    <div class="profile-header">
      <div class="avatar" id="avatar">G</div>
      <div class="profile-info">
        <h1 id="profileName">Lecturer User</h1>
        <div class="meta">Gi·∫£ng vi√™n ¬∑ <span id="departmentShort">Khoa C√¥ng ngh·ªá th√¥ng tin</span></div>
        <div class="meta" style="margin-top:6px"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#6b7280" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:8px"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5L4 8V6l8 5 8-5v2z"/></svg><span id="profileEmail">lecturer1@hcmute.edu.vn</span></div>
      </div>
      <div class="profile-actions">
        <button class="btn-edit" id="btnEdit">Ch·ªânh s·ª≠a h·ªì s∆°</button>
        <button class="btn-edit d-none" id="btnSave" style="background:#06ad5e">L∆∞u</button>
        <button class="btn-public d-none" id="btnCancel" style="margin-top:8px">H·ªßy</button>
        <div><button class="btn-public mt-2">üëÅÔ∏è Xem trang c√° nh√¢n c√¥ng khai</button></div>
      </div>
    </div>

    <div class="row mt-4 g-4">
      <div class="col-lg-8">
        <div class="card-panel mb-3">
          <div class="section-title">Gi·ªõi thi·ªáu</div>
          <div id="introText" data-editable="true">
            <b>H·ªì s∆° Gi·∫£ng vi√™n ‚Äì H·ªá th·ªëng Qu·∫£n l√Ω & S·ªë h√≥a Gi√°o tr√¨nh (SMD)</b>
            <ol>
              <li><b>Th√¥ng tin chung</b><br>
                Vai tr√≤: Gi·∫£ng vi√™n (Lecturer)<br>
                Ch·ª©c nƒÉng h·ªá th·ªëng: T·∫°o, ch·ªânh s·ª≠a, qu·∫£n l√Ω gi√°o tr√¨nh; tham gia quy tr√¨nh x√©t duy·ªát; c·ªông t√°c ph·∫£n bi·ªán<br>
                C·∫•p truy c·∫≠p: ƒêƒÉng nh·∫≠p x√°c th·ª±c, ph√¢n quy·ªÅn theo vai tr√≤ (ch·ªâ truy c·∫≠p v√† ch·ªânh s·ª≠a c√°c m√¥n/ph·∫ßn ƒë∆∞·ª£c ph√¢n c√¥ng)<br>
                ƒê·ªëi t∆∞·ª£ng s·ª≠ d·ª•ng: Gi·∫£ng vi√™n c∆° h·ªØu, th·ªânh gi·∫£ng, tr·ª£ gi·∫£ng
              </li>
              <li><b>Nhi·ªám v·ª• ch√≠nh</b>
                <ul>
                  <li>T·∫°o m·ªõi, ch·ªânh s·ª≠a, c·∫≠p nh·∫≠t gi√°o tr√¨nh m√¥n h·ªçc</li>
                  <li>G·∫Øn v√† qu·∫£n l√Ω metadata (CLO, PLO, tr·ªçng s·ªë ƒë√°nh gi√°, h·ªçc ph·∫ßn ti√™n quy·∫øt, n·ªôi dung gi·∫£ng d·∫°y, t√†i li·ªáu tham kh·∫£o)</li>
                  <li>Thi·∫øt l·∫≠p quan h·ªá gi·ªØa c√°c gi√°o tr√¨nh (thay th·∫ø, c·∫≠p nh·∫≠t, phi√™n b·∫£n m·ªõi)</li>
                  <li>G·ª≠i gi√°o tr√¨nh l√™n quy tr√¨nh x√©t duy·ªát (tr√¨nh Tr∆∞·ªüng B·ªô m√¥n/Ph√≤ng ƒê√†o t·∫°o)</li>
                  <li>Tham gia ph·∫£n bi·ªán, g√≥p √Ω, tr·∫£ l·ªùi ph·∫£n h·ªìi</li>
                  <li>Theo d√µi tr·∫°ng th√°i gi√°o tr√¨nh, nh·∫≠n th√¥ng b√°o c·∫≠p nh·∫≠t</li>
                  <li>T√¨m ki·∫øm, xem, so s√°nh c√°c phi√™n b·∫£n gi√°o tr√¨nh</li>
                  <li>S·ª≠ d·ª•ng c√°c c√¥ng c·ª• AI (ph√°t hi·ªán thay ƒë·ªïi, mapping CLO‚ÄìPLO, t√≥m t·∫Øt n·ªôi dung)</li>
                  <li>Theo d√µi gi√°o tr√¨nh ƒë·ªÉ nh·∫≠n th√¥ng b√°o khi c√≥ thay ƒë·ªïi</li>
                </ul>
              </li>
              <li><b>Tr∆∞·ªùng th√¥ng tin chi ti·∫øt</b>
                <div style="overflow-x:auto">
                  <table class="table table-bordered table-sm" style="background:#fff">
                    <thead><tr><th>T√™n tr∆∞·ªùng</th><th>M√¥ t·∫£</th><th>V√≠ d·ª•/ƒê·ªãnh d·∫°ng</th></tr></thead>
                    <tbody>
                      <tr><td>M√£ gi·∫£ng vi√™n</td><td>ƒê·ªãnh danh duy nh·∫•t (t·ª± sinh)</td><td>GV001, GV2025-123</td></tr>
                      <tr><td>H·ªç v√† t√™n</td><td>H·ªç t√™n ƒë·∫ßy ƒë·ªß</td><td>Nguy·ªÖn VƒÉn A</td></tr>
                      <tr><td>Email</td><td>Email tr∆∞·ªùng (d√πng ƒëƒÉng nh·∫≠p, nh·∫≠n th√¥ng b√°o)</td><td>nguyenvana@university.edu.vn</td></tr>
                      <tr><td>S·ªë ƒëi·ªán tho·∫°i</td><td>S·ªë li√™n h·ªá (kh√¥ng b·∫Øt bu·ªôc)</td><td>0912xxxxxx</td></tr>
                      <tr><td>Khoa/B·ªô m√¥n</td><td>ƒê∆°n v·ªã c√¥ng t√°c</td><td>Khoa CNTT</td></tr>
                      <tr><td>Ch·ª©c danh</td><td>Ch·ª©c danh h·ªçc thu·∫≠t</td><td>Gi·∫£ng vi√™n, ThS, TS</td></tr>
                      <tr><td>H·ªçc v·ªã</td><td>H·ªçc v·ªã cao nh·∫•t</td><td>ThS, TS</td></tr>
                      <tr><td>Lƒ©nh v·ª±c nghi√™n c·ª©u</td><td>C√°c lƒ©nh v·ª±c quan t√¢m (kh√¥ng b·∫Øt bu·ªôc)</td><td>AI, NLP, C√¥ng ngh·ªá gi√°o d·ª•c</td></tr>
                      <tr><td>M√¥n ph·ª• tr√°ch</td><td>Danh s√°ch m√¥n h·ªçc ƒë∆∞·ª£c ph√¢n c√¥ng</td><td>CS101, SE202</td></tr>
                      <tr><td>Gi√°o tr√¨nh ƒë√£ t·∫°o</td><td>Danh s√°ch gi√°o tr√¨nh ƒë√£ t·∫°o ho·∫∑c qu·∫£n l√Ω</td><td>SMD101, SMD102</td></tr>
                      <tr><td>Tr·∫°ng th√°i t√†i kho·∫£n</td><td>ƒêang ho·∫°t ƒë·ªông/ƒê√£ kh√≥a (do Qu·∫£n tr·ªã vi√™n qu·∫£n l√Ω)</td><td>ƒêang ho·∫°t ƒë·ªông</td></tr>
                      <tr><td>Vai tr√≤ h·ªá th·ªëng</td><td>Vai tr√≤ ƒë∆∞·ª£c g√°n (Gi·∫£ng vi√™n, Ph·∫£n bi·ªán, ...)</td><td>Gi·∫£ng vi√™n</td></tr>
                      <tr><td>Ng√†y tham gia</td><td>Ng√†y t·∫°o t√†i kho·∫£n</td><td>2025-09-01</td></tr>
                      <tr><td>L·∫ßn ƒëƒÉng nh·∫≠p cu·ªëi</td><td>Th·ªùi ƒëi·ªÉm ƒëƒÉng nh·∫≠p g·∫ßn nh·∫•t</td><td>2025-12-28 14:32</td></tr>
                      <tr><td>·∫¢nh ƒë·∫°i di·ªán</td><td>·∫¢nh h·ªì s∆° (kh√¥ng b·∫Øt bu·ªôc)</td><td>URL ho·∫∑c file upload</td></tr>
                      <tr><td>C√†i ƒë·∫∑t th√¥ng b√°o</td><td>Email/Push/Kh√¥ng nh·∫≠n</td><td>Email</td></tr>
                      <tr><td>Ng√¥n ng·ªØ giao di·ªán</td><td>Ng√¥n ng·ªØ ∆∞u ti√™n</td><td>Ti·∫øng Vi·ªát/English</td></tr>
                    </tbody>
                  </table>
                </div>
              </li>
              <li><b>Ch·ª©c nƒÉng s·ª≠ d·ª•ng</b>
                <ul>
                  <li>T·∫°o gi√°o tr√¨nh: Nh·∫≠p, ch·ªânh s·ª≠a ƒë·∫ßy ƒë·ªß c√°c m·ª•c, g·∫Øn CLO, PLO, tr·ªçng s·ªë, h·ªçc ph·∫ßn ti√™n quy·∫øt, t√†i li·ªáu tham kh·∫£o</li>
                  <li>Qu·∫£n l√Ω phi√™n b·∫£n: C·∫≠p nh·∫≠t, xem l·ªãch s·ª≠, so s√°nh c√°c phi√™n b·∫£n gi√°o tr√¨nh</li>
                  <li>Tham gia quy tr√¨nh: G·ª≠i gi√°o tr√¨nh x√©t duy·ªát, theo d√µi tr·∫°ng th√°i, ph·∫£n h·ªìi g√≥p √Ω t·ª´ Tr∆∞·ªüng B·ªô m√¥n/Ph√≤ng ƒê√†o t·∫°o</li>
                  <li>C·ªông t√°c: Tham gia ph·∫£n bi·ªán, th√™m/s·ª≠a/x√≥a b√¨nh lu·∫≠n, b√°o l·ªói n·ªôi dung</li>
                  <li>T√¨m ki·∫øm & ph√¢n t√≠ch: T√¨m ki·∫øm gi√°o tr√¨nh theo m√£/t√™n/t·ª´ kh√≥a, xem b·∫£ng mapping CLO‚ÄìPLO, c√¢y quan h·ªá h·ªçc ph·∫ßn</li>
                  <li>C√¥ng c·ª• AI: S·ª≠ d·ª•ng AI ph√°t hi·ªán thay ƒë·ªïi, mapping CLO‚ÄìPLO, t√≥m t·∫Øt n·ªôi dung</li>
                  <li>Nh·∫≠n th√¥ng b√°o: Nh·∫≠n th√¥ng b√°o th·ªùi gian th·ª±c v·ªÅ n·ªôp gi√°o tr√¨nh, h·∫°n ph·∫£n bi·ªán, ph·∫£n h·ªìi, tr·∫°ng th√°i duy·ªát</li>
                  <li>B·∫£o m·∫≠t: Ch·ªâ truy c·∫≠p n·ªôi dung ƒë∆∞·ª£c ph√¢n quy·ªÅn; m·ªçi thao t√°c ƒë·ªÅu ƒë∆∞·ª£c ghi log ph·ª•c v·ª• ki·ªÉm tra</li>
                </ul>
              </li>
              <li><b>V√≠ d·ª• user story</b><br>
                <i>L√† m·ªôt Gi·∫£ng vi√™n, t√¥i mu·ªën t·∫°o v√† c·∫≠p nh·∫≠t gi√°o tr√¨nh m√¥n h·ªçc tr·ª±c tuy·∫øn, g·∫Øn CLO, PLO v√† g·ª≠i x√©t duy·ªát, ƒë·ªÉ ƒë·∫£m b·∫£o n·ªôi dung chu·∫©n h√≥a v√† lu√¥n c·∫≠p nh·∫≠t. T√¥i mu·ªën nh·∫≠n th√¥ng b√°o v·ªÅ tr·∫°ng th√°i x√©t duy·ªát, ph·∫£n h·ªìi v√† c√≥ th·ªÉ c·ªông t√°c v·ªõi ƒë·ªìng nghi·ªáp trong qu√° tr√¨nh ph·∫£n bi·ªán.</i>
              </li>
              <li><b>B·∫£o m·∫≠t & quy·ªÅn ri√™ng t∆∞</b>
                <ul>
                  <li>M·∫≠t kh·∫©u ƒë∆∞·ª£c m√£ h√≥a m·ªôt chi·ªÅu, kh√¥ng l∆∞u d·∫°ng r√µ</li>
                  <li>Quy·ªÅn truy c·∫≠p gi√°o tr√¨nh ph√¢n theo vai tr√≤, b·ªô m√¥n</li>
                  <li>M·ªçi thao t√°c (t·∫°o, s·ª≠a, g·ª≠i, b√¨nh lu·∫≠n) ƒë·ªÅu ƒë∆∞·ª£c ghi log ph·ª•c v·ª• ki·ªÉm tra</li>
                </ul>
              </li>
              <li><b>Giao di·ªán ng∆∞·ªùi d√πng</b>
                <ul>
                  <li>Giao di·ªán nh·∫≠p li·ªáu tr·ª±c quan, d·ªÖ s·ª≠ d·ª•ng</li>
                  <li>Hi·ªÉn th·ªã r√µ tr·∫°ng th√°i quy tr√¨nh (Nh√°p, Ch·ªù duy·ªát, ƒê√£ duy·ªát, ...)</li>
                  <li>D·ªÖ d√†ng truy c·∫≠p l·ªãch s·ª≠, so s√°nh phi√™n b·∫£n</li>
                  <li>H·ªó tr·ª£ t·ªët tr√™n m√°y t√≠nh v√† thi·∫øt b·ªã di ƒë·ªông</li>
                </ul>
              </li>
            </ol>
          </div>
          <button class="btn btn-outline-primary btn-sm" id="btnAddIntro">+ Th√™m gi·ªõi thi·ªáu</button>
        </div>

        <div class="card-panel mb-3">
          <div class="section-title">C√°c h·ªçc ph·∫ßn ƒëang gi·∫£ng d·∫°y</div>
          <div id="courseList" style="display:flex;flex-wrap:wrap;gap:12px 12px"></div>
          <button class="btn btn-outline-primary btn-sm mt-2" id="btnAddCourse">+ Th√™m h·ªçc ph·∫ßn</button>
        </div>

        <div class="card-panel">
          <div class="section-title">Ho·∫°t ƒë·ªông & C√¥ng b·ªë</div>
          <div id="activityList">
            <div class="activity-item">
              <div style="width:36px;display:flex;align-items:flex-start;justify-content:center;color:#6b7280">üìÑ</div>
              <div>
                <div style="font-weight:600">Tham gia x√¢y d·ª±ng v√† chu·∫©n h√≥a gi√°o tr√¨nh "C∆° s·ªü d·ªØ li·ªáu" theo chu·∫©n ƒë·∫ßu ra PLO.</div>
                <div class="text-muted small">nguyenvana@university.edu.vn</div>
              </div>
            </div>
            <div class="activity-item">
              <div style="width:36px;display:flex;align-items:flex-start;justify-content:center;color:#6b7280">üìÑ</div>
              <div>
                <div style="font-weight:600">C·ªông t√°c ph·∫£n bi·ªán gi√°o tr√¨nh "Ph√¢n t√≠ch & Thi·∫øt k·∫ø h·ªá th·ªëng".</div>
                <div class="text-muted small">nguyenvana@university.edu.vn</div>
              </div>
            </div>
            <div class="activity-item">
              <div style="width:36px;display:flex;align-items:flex-start;justify-content:center;color:#6b7280">üìÑ</div>
              <div>
                <div style="font-weight:600">Nghi√™n c·ª©u ·ª©ng d·ª•ng AI trong ki·ªÉm tra logic CLO‚ÄìPLO v√† t√≥m t·∫Øt n·ªôi dung gi√°o tr√¨nh.</div>
                <div class="text-muted small">nguyenvana@university.edu.vn</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card-panel mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <div class="section-title">Ho√†n thi·ªán h·ªì s∆°</div>
            <div class="text-muted">60%</div>
          </div>
          <div class="progress progress-small mb-3"><div class="progress-bar bg-primary" role="progressbar" style="width:60%"></div></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" id="c1"><label class="form-check-label small" for="c1">Th√™m s·ªë ƒëi·ªán tho·∫°i</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" id="c2"><label class="form-check-label small" for="c2">C·∫≠p nh·∫≠t ti·ªÉu s·ª≠</label></div>
          <div class="form-check"><input class="form-check-input" type="checkbox" id="c3" checked><label class="form-check-label small" for="c3">X√°c th·ª±c email</label></div>
        </div>

        <div class="card-panel mb-3">
          <div class="section-title">Th√¥ng tin li√™n h·ªá</div>
          <div class="small text-muted">üìû <span id="phoneVal" class="editable-field" style="cursor:pointer">09xx xxx xxx</span></div>
          <div class="mt-2 d-flex justify-content-between"><div class="text-muted small">Khoa/Ph√≤ng:</div><div id="deptVal" class="fw-bold small editable-field" style="cursor:pointer">Khoa CNTT</div></div>
          <div class="d-flex justify-content-between"><div class="text-muted small">M√£ nh√¢n vi√™n:</div><div id="empVal" class="fw-bold small editable-field" style="cursor:pointer">HCMUTE-123</div></div>
        </div>

        <div class="card-panel">
          <div class="section-title">H√†nh ƒë·ªông nhanh</div>
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary side-btn">M·ªü Dashboard</button>
            <button class="btn btn-outline-secondary side-btn">ƒê·ªïi m·∫≠t kh·∫©u</button>
            <button class="btn btn-light side-btn" id="btnLogout">ƒêƒÉng xu·∫•t</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:8000';
    const token = localStorage.getItem('access_token');

    function setAvatarLetter(name){ if(!name) return; document.getElementById('avatar').textContent = name.trim().charAt(0).toUpperCase(); }

    // L∆∞u tr·ªØ t·∫°m th·ªùi danh s√°ch h·ªçc ph·∫ßn
    let courseList = ["C∆° s·ªü d·ªØ li·ªáu", "Ph√¢n t√≠ch & Thi·∫øt k·∫ø h·ªá th·ªëng", "Qu·∫£n l√Ω d·ª± √°n ph·∫ßn m·ªÅm", "Nh·∫≠p m√¥n AI"];

    async function loadProfile(){
      if(!token){return}
      try{
        const r = await fetch(`${API_URL}/users/me`,{headers:{'Authorization':`Bearer ${token}`}});
        if(!r.ok) return;
        const u = await r.json();
        document.getElementById('profileName').textContent = u.full_name || u.email;
        document.getElementById('profileEmail').textContent = u.email || '';
        document.getElementById('departmentShort').textContent = u.department || '';
        document.getElementById('phoneVal').textContent = u.phone || '09xx xxx xxx';
        document.getElementById('deptVal').textContent = u.department || 'Khoa CNTT';
        document.getElementById('empVal').textContent = u.employee_id || '-';
        setAvatarLetter(u.full_name || u.email);
        // N·∫øu backend tr·∫£ v·ªÅ danh s√°ch h·ªçc ph·∫ßn, c·∫≠p nh·∫≠t courseList
        if(u.courses && Array.isArray(u.courses)) courseList = u.courses;
        renderCourseList();
      }catch(e){console.error(e)}
    }

    function renderCourseList() {
      const listEl = document.getElementById('courseList');
      listEl.innerHTML = '';
      courseList.forEach((course, idx) => {
        const pill = document.createElement('span');
        pill.className = 'course-pill';
        pill.style.position = 'relative';
        pill.textContent = course;
        pill.setAttribute('data-idx', idx);
        pill.style.cursor = 'pointer';
        // S·ª≠a t√™n h·ªçc ph·∫ßn
        pill.addEventListener('dblclick', function() {
          const input = document.createElement('input');
          input.type = 'text';
          input.value = course;
          input.style.width = '160px';
          input.className = 'form-control form-control-sm';
          pill.textContent = '';
          pill.appendChild(input);
          input.focus();
          input.addEventListener('blur', function() {
            if(input.value.trim()) courseList[idx] = input.value.trim();
            renderCourseList();
          });
          input.addEventListener('keydown', function(e){
            if(e.key==='Enter'){input.blur();}
            if(e.key==='Escape'){renderCourseList();}
          });
        });
        // N√∫t x√≥a
        const delBtn = document.createElement('span');
        delBtn.textContent = ' √ó';
        delBtn.style.color = '#e11d48';
        delBtn.style.cursor = 'pointer';
        delBtn.style.marginLeft = '6px';
        delBtn.title = 'X√≥a h·ªçc ph·∫ßn';
        delBtn.onclick = function(e){
          e.stopPropagation();
          courseList.splice(idx,1); renderCourseList();
        };
        pill.appendChild(delBtn);
        listEl.appendChild(pill);
      });
    }

    document.getElementById('btnAddCourse').addEventListener('click', function(){
      courseList.push('H·ªçc ph·∫ßn m·ªõi');
      renderCourseList();
    });

    // Cho ph√©p click v√†o c√°c tr∆∞·ªùng li√™n h·ªá ƒë·ªÉ s·ª≠a tr·ª±c ti·∫øp
    document.querySelectorAll('.editable-field').forEach(el=>{
      el.addEventListener('click', function(){
        if(el.querySelector('input')) return;
        const oldVal = el.textContent;
        const input = document.createElement('input');
        input.type = 'text';
        input.value = oldVal;
        input.className = 'form-control form-control-sm';
        input.style.width = '140px';
        el.textContent = '';
        el.appendChild(input);
        input.focus();
        input.addEventListener('blur', function(){
          el.textContent = input.value.trim() || oldVal;
        });
        input.addEventListener('keydown', function(e){
          if(e.key==='Enter'){input.blur();}
          if(e.key==='Escape'){el.textContent = oldVal;}
        });
      });
    });

    // G·ªçi l·∫°i renderCourseList khi t·∫£i trang
    window.addEventListener('DOMContentLoaded', renderCourseList);

    document.getElementById('btnLogout').addEventListener('click',()=>{localStorage.clear();location.href='/index.html'});

    // Inline edit mode
    const btnEdit = document.getElementById('btnEdit');
    const btnSave = document.getElementById('btnSave');
    const btnCancel = document.getElementById('btnCancel');
    let editMode = false;

    function toggleEdit(enable){
      editMode = enable;
      document.querySelectorAll('[data-editable]').forEach(el=>{
        el.contentEditable = enable ? 'true' : 'false';
        el.style.outline = enable ? '2px dashed rgba(90,100,200,0.18)' : 'none';
        if(enable) el.classList.add('editable'); else el.classList.remove('editable');
      });
      // allow editing main fields
      const nameEl = document.getElementById('profileName');
      nameEl.contentEditable = enable ? 'true' : 'false';
      nameEl.style.outline = enable ? '2px dashed rgba(90,100,200,0.18)' : 'none';

      // phone/department/employee id
      ['phoneVal','deptVal','empVal','introText'].forEach(id=>{
        const e = document.getElementById(id);
        if(e){ e.contentEditable = enable ? 'true' : 'false'; e.style.outline = enable ? '2px dashed rgba(90,100,200,0.18)' : 'none'; }
      });

      btnEdit.classList.toggle('d-none', enable);
      btnSave.classList.toggle('d-none', !enable);
      btnCancel.classList.toggle('d-none', !enable);
    }

    btnEdit.addEventListener('click',()=>{ toggleEdit(true); window.scrollTo({top:0,behavior:'smooth'}) });
    btnCancel.addEventListener('click',()=>{ toggleEdit(false); loadProfile(); });

    async function saveProfile(){
      // L·∫•y gi√° tr·ªã m·ªõi nh·∫•t t·ª´ c√°c tr∆∞·ªùng li√™n h·ªá
      const full_name = document.getElementById('profileName').textContent.trim();
      const phone = document.getElementById('phoneVal').textContent.trim();
      const department = document.getElementById('deptVal').textContent.trim();
      const biography = document.getElementById('introText')?.textContent.trim() || '';
      const employee_id = document.getElementById('empVal').textContent.trim();
      // Ch·ªâ g·ª≠i c√°c tr∆∞·ªùng backend h·ªó tr·ª£
      const payload = { full_name, phone, department, biography, employee_id };
      try{
        const r = await fetch(`${API_URL}/users/me`,{
          method: 'PUT',
          headers: {'Content-Type':'application/json','Authorization':`Bearer ${token}`},
          body: JSON.stringify(payload)
        });
        if(!r.ok) {
          let msg = 'L∆∞u th·∫•t b·∫°i';
          try {
            const err = await r.json();
            msg += err.detail ? (': ' + err.detail) : (typeof err === 'string' ? (': ' + err) : '');
          } catch {}
          throw new Error(msg);
        }
        toggleEdit(false);
        loadProfile();
        alert('C·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng');
      }catch(e){
        console.error(e);
        alert(e.message || 'L∆∞u th·∫•t b·∫°i');
      }
    }

    btnSave.addEventListener('click', saveProfile);

    document.getElementById('btnEdit').addEventListener('keydown', (e)=>{ if(e.key==='Enter') { e.preventDefault(); toggleEdit(true); } });

    // allow adding intro default
    document.getElementById('btnAddIntro').addEventListener('click', ()=>{ document.getElementById('introText').focus(); toggleEdit(true); });

    document.getElementById('btnEdit').addEventListener('click', ()=>{});

    loadProfile();
  </script>
</body>
</html>
