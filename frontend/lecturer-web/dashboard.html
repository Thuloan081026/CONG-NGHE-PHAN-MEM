<!DOCTYPE html>
<html lang="vi">
<head>
    <title>Lecturer Dashboard - SMD System</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    
    <!-- Favicon icon -->
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    <!-- Font Awesome -->
    <link rel="stylesheet" type="text/css" href="assets/icon/icofont/css/icofont.css">
    <!-- Themify -->
    <link rel="stylesheet" type="text/css" href="assets/icon/themify-icons/themify-icons.css">
    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap-theme.min.css">
    <!-- Required Fremwork -->
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap/css/bootstrap.min.css">
    <!-- Main Styles -->
    <link rel="stylesheet" type="text/css" href="assets/css/main.css">
    <link rel="stylesheet" type="text/css" href="assets/css/menu.css">
    <link rel="stylesheet" type="text/css" href="assets/css/color/color-1.css" id="color" />
    <link rel="stylesheet" type="text/css" href="assets/css/responsive.css">
    
    <!-- Custom Dashboard Styles -->
    <link rel="stylesheet" type="text/css" href="assets/css/lecturer-dashboard.css">
</head>

<body class="sidebar-mini fixed">

    <!-- Pre-loader start -->
    <div class="loader-bg">
        <div class="loader-bar"></div>
    </div>
    <!-- Pre-loader end -->

    <div class="wrapper">
        <!-- Navbar-->
        <header class="main-header-top hidden-print">
            <a href="dashboard.html" class="logo">
                <h4 style="color: white; margin: 0; padding: 10px;">SMD - Lecturer</h4>
            </a>
            <nav class="navbar navbar-static-top">
                <!-- Sidebar toggle button-->
                <a href="#!" data-toggle="offcanvas" class="sidebar-toggle"></a>
                
                <!-- Navbar Right Menu-->
                <div class="navbar-custom-menu f-right">
                    <ul class="top-nav">
                        <!-- Notifications -->
                        <li class="dropdown notification-menu">
                            <a href="#!" data-toggle="dropdown" aria-expanded="false" class="dropdown-toggle">
                                <i class="icon-bell"></i>
                                <span class="badge badge-danger header-badge">0</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="not-head">You have <b class="text-primary">0</b> new notifications.</li>
                                <li class="not-footer">
                                    <a href="notifications.html">See all notifications.</a>
                                </li>
                            </ul>
                        </li>
                        
                        <!-- User Menu-->
                        <li class="dropdown">
                            <a href="#!" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle drop icon-circle drop-image">
                                <span><i class="ti-user"></i></span>
                                <span id="userName">Lecturer</span> <i class="icofont icofont-simple-down"></i>
                            </a>
                            <ul class="dropdown-menu settings-menu">
                                <li><a href="profile.html"><i class="icon-user"></i> Profile</a></li>
                                <li><a href="#" onclick="logout()"><i class="icon-logout"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        
        <!-- Side-Nav-->
        <aside class="main-sidebar hidden-print">
            <section class="sidebar" id="sidebar-scroll">
                <!-- Sidebar Menu-->
                <ul class="sidebar-menu">
                    <li class="nav-level"><i class="ti-layout-grid2"></i> Navigation</li>
                    <li class="active">
                        <a class="waves-effect waves-dark" href="dashboard.html">
                            <i class="ti-dashboard"></i><span> Dashboard</span>
                        </a>
                    </li>
                    
                    <li class="nav-level"><i class="ti-files"></i> Syllabus Management</li>
                    <li class="treeview">
                        <a class="waves-effect waves-dark" href="#!">
                            <i class="ti-book"></i><span> My Syllabuses</span>
                            <span class="badge badge-primary" style="margin-left: 10px;">5</span>
                            <i class="ti-angle-down" style="float: right; margin-top: 5px;"></i>
                        </a>
                        <ul class="treeview-menu">
                            <li><a class="waves-effect waves-dark" href="syllabus-list.html"><i class="ti-list"></i> View All</a></li>
                            <li><a class="waves-effect waves-dark" href="syllabus-create.html"><i class="ti-plus"></i> Create New</a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-level"><i class="ti-comments"></i> Collaboration</li>
                    <li>
                        <a class="waves-effect waves-dark" href="comments-feedback.html">
                            <i class="ti-comment-alt"></i><span> Reviews & Feedback</span>
                        </a>
                    </li>
                    <li>
                        <a class="waves-effect waves-dark" href="search-reference.html">
                            <i class="ti-search"></i><span> Search References</span>
                        </a>
                    </li>
                    
                    <li class="nav-level"><i class="ti-settings"></i> Settings</li>
                    <li>
                        <a class="waves-effect waves-dark" href="profile.html">
                            <i class="ti-user"></i><span> My Profile</span>
                        </a>
                    </li>
                    <li>
                        <a class="waves-effect waves-dark" href="notifications.html">
                            <i class="ti-bell"></i><span> Notifications</span>
                        </a>
                    </li>
                    
                    <li class="nav-level"><i class="ti-power-off"></i> Account</li>
                    <li>
                        <a class="waves-effect waves-dark" href="#!" onclick="logout()" style="color: #f44336;">
                            <i class="ti-power-off"></i><span> Logout</span>
                        </a>
                    </li>
                </ul>
            </section>
        </aside>
        
        <div class="content-wrapper">
            <!-- Container-fluid starts -->
            <div class="container-fluid">
                <div class="row">
                    <div class="main-header">
                        <h4>Lecturer Dashboard</h4>
                    </div>
                </div>
                
                <!-- Welcome Message -->
                <div class="row">
                    <div class="col-12">
                        <div class="welcome-box">
                            <h4>ðŸ‘‹ Welcome back, <span id="welcomeName">Lecturer</span>!</h4>
                            <p>Here's your syllabus overview and recent activities</p>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics Cards -->
                <div class="row dashboard-header">
                    <div class="col-lg-3 col-md-6">
                        <div class="card dashboard-product stat-card">
                            <i class="ti-files stat-icon"></i>
                            <div class="stat-label">Total Syllabuses</div>
                            <div class="stat-number" id="totalSyllabuses">0</div>
                            <div class="stat-description">All time created</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card dashboard-product stat-card success">
                            <i class="ti-check-box stat-icon"></i>
                            <div class="stat-label">Published</div>
                            <div class="stat-number" id="publishedSyllabuses">0</div>
                            <div class="stat-description">Live syllabuses</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card dashboard-product stat-card warning">
                            <i class="ti-clipboard stat-icon"></i>
                            <div class="stat-label">In Review</div>
                            <div class="stat-number" id="reviewSyllabuses">0</div>
                            <div class="stat-description">Awaiting approval</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card dashboard-product stat-card info">
                            <i class="ti-pencil-alt stat-icon"></i>
                            <div class="stat-label">Draft</div>
                            <div class="stat-number" id="draftSyllabuses">0</div>
                            <div class="stat-description">Work in progress</div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity & Quick Actions -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-header-text"><i class="ti-files"></i> My Recent Syllabuses</h5>
                            </div>
                            <div class="card-block" style="padding: 15px;">
                                <div id="recentSyllabuses">
                                    <div style="text-align: center; color: #999;">
                                        <p>Loading syllabuses...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-header-text"><i class="ti-layout-grid2"></i> Quick Actions</h5>
                            </div>
                            <div class="card-block">
                                <a href="syllabus-create.html" class="btn btn-primary btn-block" style="margin-bottom: 10px;">
                                    <i class="ti-plus"></i> Create New
                                </a>
                                <a href="syllabus-list.html" class="btn btn-outline-primary btn-block" style="margin-bottom: 10px;">
                                    <i class="ti-files"></i> View All
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Container-fluid ends -->
        </div>
    </div>

    <script>
        // ===== LECTURER DASHBOARD WITH MOCK DATA ============
        const API_URL = 'http://localhost:8000';

        // ðŸ“Š MOCK DATA - Real data for testing
        const mockLecturerData = {
          syllabuses: [
            { id: 1, code: 'CS301', name: 'CÆ¡ sá»Ÿ dá»¯ liá»‡u nÃ¢ng cao', status: 'published', updated_at: '2026-01-25T10:00:00', faculty: 'CNTT' },
            { id: 2, code: 'CS401', name: 'TrÃ­ tuá»‡ nhÃ¢n táº¡o', status: 'in_review', updated_at: '2026-01-24T14:30:00', faculty: 'CNTT' },
            { id: 3, code: 'CS201', name: 'Cáº¥u trÃºc dá»¯ liá»‡u', status: 'published', updated_at: '2026-01-23T09:15:00', faculty: 'CNTT' },
            { id: 4, code: 'CS102', name: 'Láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng', status: 'draft', updated_at: '2026-01-22T11:45:00', faculty: 'CNTT' },
            { id: 5, code: 'CS303', name: 'Máº¡ng mÃ¡y tÃ­nh', status: 'published', updated_at: '2026-01-21T15:20:00', faculty: 'CNTT' }
          ]
        };

        // Get authentication token and user data
        const token = localStorage.getItem('access_token');
        let userData = null;

        // ðŸ” Try to get current user from API
        async function fetchCurrentUser() {
            if (!token) return null;
            try {
                const res = await fetch(`${API_URL}/users/me`, { headers: { 'Authorization': `Bearer ${token}` } });
                if (!res.ok) throw new Error('Not authenticated');
                return await res.json();
            } catch (err) {
                console.warn('Could not fetch user:', err.message);
                return null;
            }
        }

        // Calculate statistics from mock data
        function calculateStats(syllabuses) {
            const total = syllabuses.length;
            const published = syllabuses.filter(s => s.status === 'published').length;
            const inReview = syllabuses.filter(s => s.status === 'in_review').length;
            const draft = syllabuses.filter(s => s.status === 'draft').length;
            
            return { total, published, inReview, draft };
        }

        // Render statistics
        function renderStats(stats) {
            document.getElementById('totalSyllabuses').textContent = stats.total;
            document.getElementById('publishedSyllabuses').textContent = stats.published;
            document.getElementById('reviewSyllabuses').textContent = stats.inReview;
            document.getElementById('draftSyllabuses').textContent = stats.draft;
        }

        // Render recent syllabuses
        function renderRecentSyllabuses(syllabuses) {
            const container = document.getElementById('recentSyllabuses');
            
            if (syllabuses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #999; padding: 20px;">
                        <p>No syllabuses found. <a href="syllabus-create.html">Create your first syllabus</a></p>
                    </div>
                `;
                return;
            }

            const getStatusBadge = (status) => {
                const badges = {
                    'published': '<span class="badge badge-success">Published</span>',
                    'in_review': '<span class="badge badge-warning">In Review</span>',
                    'draft': '<span class="badge badge-info">Draft</span>'
                };
                return badges[status] || '<span class="badge badge-secondary">Unknown</span>';
            };

            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('vi-VN');
            };

            const html = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Updated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${syllabuses.slice(0, 5).map(s => `
                                <tr>
                                    <td><strong>${s.code}</strong></td>
                                    <td>${s.name}</td>
                                    <td>${getStatusBadge(s.status)}</td>
                                    <td>${formatDate(s.updated_at)}</td>
                                    <td>
                                        <a href="syllabus-view.html?id=${s.id}" class="btn btn-sm btn-primary">
                                            <i class="ti-eye"></i> View
                                        </a>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Initialize dashboard
        async function initDashboard() {
            // Try to fetch real user data
            userData = await fetchCurrentUser();
            
            if (userData) {
                console.log('Authenticated as:', userData.full_name);
            }

            // Use mock data for display
            const stats = calculateStats(mockLecturerData.syllabuses);
            renderStats(stats);
            renderRecentSyllabuses(mockLecturerData.syllabuses);
            
            // Hide preloader
            setTimeout(() => {
                const loader = document.querySelector('.loader-bg');
                if (loader) {
                    loader.style.display = 'none';
                }
            }, 300);
        }

        // Load dashboard when page is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDashboard);
        } else {
            initDashboard();
        }

        // Logout function
        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('token');
            localStorage.clear();
            window.location.href = 'index.html';
        }

</script>
    <script>
        // Handle link navigation
        document.addEventListener('click', function (ev) {
            try {
                const a = ev.target.closest && ev.target.closest('a');
                if (!a) return;
                const href = a.getAttribute('href');
if (!href || href.startsWith('#')) return;
                if (href.endsWith('.html') || href.includes('/')) {
                    ev.preventDefault();
                    window.location.assign(href);
                }
            } catch (e) {
                console.warn('Navigation error', e);
            }
        }, false);
    </script>
</body>
</html>
