<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SMD System</title>
    <link rel="stylesheet" href="../admin-web/assets/css/styles.min.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #5570f1;
            --success: #13deb9;
            --warning: #ffb64d;
            --danger: #fa5441;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f7fa;
            margin: 0;
            padding: 0;
        }
        .container-fluid { display: flex; min-height: 100vh; }
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #5570f1 0%, #4a60d4 100%);
            color: white;
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        .sidebar-menu { list-style: none; }
        .sidebar-menu a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            display: block;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 5px 0;
            transition: all 0.3s;
        }
        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .main-content { margin-left: 280px; flex: 1; }
        .topbar {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .page { padding: 30px; }
        .page { display: none; }
        .page.active { display: block; }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .stat-card:nth-child(2) { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card:nth-child(3) { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card:nth-child(4) { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .stat-value { font-size: 32px; font-weight: bold; margin: 10px 0; }
        .table-responsive { overflow-x: auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 15px; text-align: left; font-weight: 600; border-bottom: 1px solid #ddd; }
        td { padding: 12px 15px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f8f9fa; }
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #5570f1; color: white; }
        .btn-danger { background: #fa5441; color: white; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Sidebar -->
        <div class="sidebar">
            <h4 style="margin-bottom: 30px; text-align: center;">üõ°Ô∏è Admin</h4>
            <ul class="sidebar-menu">
                <li><a href="javascript:void(0)" onclick="showPage('dashboard')" class="active">üìä Dashboard</a></li>
                <li><a href="javascript:void(0)" onclick="showPage('users')">üë• Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</a></li>
                <li><a href="javascript:void(0)" onclick="showPage('system')">‚öôÔ∏è C√†i ƒê·∫∑t H·ªá Th·ªëng</a></li>
                <li><a href="javascript:void(0)" onclick="showPage('reports')">üìà B√°o C√°o</a></li>
                <li><hr style="border: none; border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0;"></li>
                <li><a href="javascript:void(0)" onclick="logout()">üö™ ƒêƒÉng Xu·∫•t</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="topbar">
                <h3>Admin Dashboard</h3>
                <div>
                    <span id="userName">Admin</span> | <a href="javascript:void(0)" onclick="logout()">Logout</a>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <h2>üìä T·ªïng Quan H·ªá Th·ªëng</h2>
                <div class="grid">
                    <div class="stat-card">
                        <div style="opacity: 0.9;">T·ªïng Ng∆∞·ªùi D√πng</div>
                        <div class="stat-value" id="totalUsers">2,850</div>
                    </div>
                    <div class="stat-card">
                        <div style="opacity: 0.9;">Gi√°o Tr√¨nh Ho·∫°t ƒê·ªông</div>
                        <div class="stat-value" id="activeSyllabi">487</div>
                    </div>
                    <div class="stat-card">
                        <div style="opacity: 0.9;">L·ªói H·ªá Th·ªëng</div>
                        <div class="stat-value" id="systemErrors">3</div>
                    </div>
                    <div class="stat-card">
                        <div style="opacity: 0.9;">Server Uptime</div>
                        <div class="stat-value" id="uptime">99.8%</div>
                    </div>
                </div>

                <h3 style="margin-top: 40px;">Ho·∫°t ƒê·ªông G·∫ßn ƒê√¢y</h3>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Th·ªùi Gian</th>
                                <th>Ng∆∞·ªùi D√πng</th>
                                <th>H√†nh ƒê·ªông</th>
                                <th>Lo·∫°i</th>
                                <th>Tr·∫°ng Th√°i</th>
                            </tr>
                        </thead>
                        <tbody id="activityTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Users Page -->
            <div id="page-users" class="page">
                <h2>üë• Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</h2>
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary">+ Th√™m Ng∆∞·ªùi D√πng</button>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>T√™n</th>
                                <th>Vai Tr√≤</th>
                                <th>Tr·∫°ng Th√°i</th>
                                <th>Ng√†y T·∫°o</th>
                                <th>H√†nh ƒê·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- System Page -->
            <div id="page-system" class="page">
                <h2>‚öôÔ∏è C√†i ƒê·∫∑t H·ªá Th·ªëng</h2>
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>C∆° S·ªü D·ªØ Li·ªáu</h4>
                    <p>Tr·∫°ng Th√°i: <span class="badge badge-success">K·∫øt N·ªëi</span></p>
                    <p>B·∫£ng: <strong id="tableCount">12</strong></p>
                    <button class="btn btn-primary" style="margin-top: 10px;">Sao L∆∞u</button>
                </div>
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>Email SMTP</h4>
                    <p>Tr·∫°ng Th√°i: <span class="badge badge-success">C·∫•u H√¨nh</span></p>
                    <p>Email Ki·ªÉm Tra: <strong>admin@edu.vn</strong></p>
                    <button class="btn btn-primary" style="margin-top: 10px;">G·ª≠i Th·ª≠</button>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="page-reports" class="page">
                <h2>üìà B√°o C√°o H·ªá Th·ªëng</h2>
                <div class="grid">
                    <div class="stat-card">
                        <div style="opacity: 0.9;">Gi√°o Tr√¨nh M·ªõi (Tu·∫ßn)</div>
                        <div class="stat-value">24</div>
                    </div>
                    <div class="stat-card">
                        <div style="opacity: 0.9;">Ng∆∞·ªùi D√πng M·ªõi (Tu·∫ßn)</div>
                        <div class="stat-value">18</div>
                    </div>
                    <div class="stat-card">
                        <div style="opacity: 0.9;">L·ªói (Tu·∫ßn)</div>
                        <div class="stat-value">2</div>
                    </div>
                    <div class="stat-card">
                        <div style="opacity: 0.9;">Y√™u C·∫ßu API (Gi·ªù)</div>
                        <div class="stat-value">12.5K</div>
                    </div>
                </div>
                <h3>Th·ªëng K√™ Vai Tr√≤</h3>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Vai Tr√≤</th>
                                <th>S·ªë L∆∞·ª£ng</th>
                                <th>Ph·∫ßn TrƒÉm</th>
                                <th>Tr·∫°ng Th√°i</th>
                            </tr>
                        </thead>
                        <tbody id="roleStatsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data
        const mockAdminData = {
            users: [
                { id: 1, email: 'principal@edu.vn', name: 'Tr·∫ßn Minh Hi·ªÅn', role: 'principal', status: 'active', created: '2025-10-01' },
                { id: 2, email: 'lecturer@edu.vn', name: 'Nguy·ªÖn VƒÉn A', role: 'lecturer', status: 'active', created: '2025-10-02' },
                { id: 3, email: 'student@edu.vn', name: 'L√™ Th·ªã B', role: 'student', status: 'active', created: '2025-10-03' },
                { id: 4, email: 'admin@edu.vn', name: 'Ph·∫°m VƒÉn C', role: 'admin', status: 'active', created: '2025-10-04' },
                { id: 5, email: 'aa@edu.vn', name: 'Ho√†ng Th·ªã D', role: 'academic_affairs', status: 'active', created: '2025-10-05' },
                { id: 6, email: 'hod@edu.vn', name: 'V≈© VƒÉn E', role: 'hod', status: 'active', created: '2025-10-06' }
            ],
            activities: [
                { time: '14:35', user: 'Nguy·ªÖn VƒÉn A', action: 'T·∫°o gi√°o tr√¨nh CS301', type: 'syllabus_create', status: 'success' },
                { time: '13:20', user: 'L√™ Th·ªã B', action: 'Xem gi√°o tr√¨nh CS401', type: 'syllabus_view', status: 'success' },
                { time: '12:10', user: 'Tr·∫ßn Minh Hi·ªÅn', action: 'Duy·ªát gi√°o tr√¨nh MATH101', type: 'syllabus_approve', status: 'success' },
                { time: '11:45', user: 'Ho√†ng Th·ªã D', action: 'C·∫≠p nh·∫≠t c√†i ƒë·∫∑t', type: 'system_config', status: 'success' },
                { time: '10:30', user: 'V≈© VƒÉn E', action: 'Xem b√°o c√°o h√†ng th√°ng', type: 'report_view', status: 'success' }
            ],
            roleStats: [
                { role: 'Student', count: 1850, percent: 65 },
                { role: 'Lecturer', count: 450, percent: 15.8 },
                { role: 'Admin', count: 8, percent: 0.3 },
                { role: 'Academic Affairs', count: 12, percent: 0.4 },
                { role: 'HOD', count: 25, percent: 0.9 },
                { role: 'Principal', count: 5, percent: 0.2 }
            ]
        };

        const token = localStorage.getItem('access_token');
        
        // Check auth
        if (token) {
            fetch('http://localhost:8000/users/me', {
                method: 'GET',
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(r => r.json())
            .then(user => {
                if (user.role !== 'admin') {
                    window.location.href = '../index.html';
                }
                document.getElementById('userName').textContent = user.full_name || 'Admin';
            })
            .catch(err => console.log('Auth check: using demo data'));
        }

        // Initialize
        function initializeAdmin() {
            loadDashboard();
            loadUsers();
            loadRoleStats();
        }

        function loadDashboard() {
            const tbody = document.getElementById('activityTable');
            tbody.innerHTML = mockAdminData.activities.map(a => `
                <tr>
                    <td>${a.time}</td>
                    <td>${a.user}</td>
                    <td>${a.action}</td>
                    <td>${a.type}</td>
                    <td><span class="badge badge-success">${a.status}</span></td>
                </tr>
            `).join('');
        }

        function loadUsers() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = mockAdminData.users.map(u => `
                <tr>
                    <td>${u.email}</td>
                    <td>${u.name}</td>
                    <td>${u.role}</td>
                    <td><span class="badge badge-success">${u.status}</span></td>
                    <td>${u.created}</td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px;">S·ª≠a</button>
                        <button class="btn btn-danger" style="padding: 5px 10px;">X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }

        function loadRoleStats() {
            const tbody = document.getElementById('roleStatsTable');
            tbody.innerHTML = mockAdminData.roleStats.map(r => `
                <tr>
                    <td>${r.role}</td>
                    <td>${r.count}</td>
                    <td>${r.percent}%</td>
                    <td><div style="background: #5570f1; color: white; padding: 5px 10px; border-radius: 3px; width: ${r.percent * 2}px;">ƒêang Ho·∫°t</div></td>
                </tr>
            `).join('');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
            event.target.classList.add('active');
        }

        function logout() {
            localStorage.clear();
            window.location.href = '../index.html';
        }

        document.addEventListener('DOMContentLoaded', initializeAdmin);
    </script>
</body>
</html>
