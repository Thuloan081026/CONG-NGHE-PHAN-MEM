<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Giáo trình theo dõi - SMD System</title>
  <link href="img/logo/logo.png" rel="icon">
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="css/ruang-admin.min.css" rel="stylesheet">
</head>

<body id="page-top">
  <div id="wrapper">
    <!-- Sidebar -->
    <ul class="navbar-nav sidebar sidebar-light accordion" id="accordionSidebar">
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="dashboard.html">
        <div class="sidebar-brand-icon">
          <img src="img/logo/logo.png" style="max-width: 40px;">
        </div>
        <div class="sidebar-brand-text mx-3">SMD Student</div>
      </a>
      <hr class="sidebar-divider my-0">
      <li class="nav-item">
        <a class="nav-link" href="dashboard.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span></a>
      </li>
      <hr class="sidebar-divider">
      <div class="sidebar-heading">Syllabus</div>
      <li class="nav-item">
        <a class="nav-link" href="syllabus-search.html">
          <i class="fas fa-fw fa-search"></i>
          <span>Tìm kiếm Giáo trình</span>
        </a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="my-subscriptions.html">
          <i class="fas fa-fw fa-star"></i>
          <span>Giáo trình theo dõi</span>
        </a>
      </li>
      <hr class="sidebar-divider">
      <div class="sidebar-heading">Account</div>
      <li class="nav-item">
        <a class="nav-link" href="profile.html">
          <i class="fas fa-fw fa-user"></i>
          <span>Thông tin cá nhân</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="handleLogout()">
          <i class="fas fa-fw fa-sign-out-alt"></i>
          <span>Đăng xuất</span>
        </a>
      </li>
    </ul>

    <div id="content-wrapper" class="d-flex flex-column">
      <div id="content">
        <!-- TopBar -->
        <nav class="navbar navbar-expand navbar-light bg-navbar topbar mb-4 static-top">
          <button id="sidebarToggleTop" class="btn btn-link rounded-circle mr-3">
            <i class="fa fa-bars"></i>
          </button>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown no-arrow">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown">
                <img class="img-profile rounded-circle" src="img/logo/logo.png" style="max-width: 60px">
                <span class="ml-2 d-none d-lg-inline text-white small" id="userFullName">Student</span>
              </a>
              <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in">
                <a class="dropdown-item" href="profile.html">
                  <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> Profile
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#" onclick="handleLogout()">
                  <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Logout
                </a>
              </div>
            </li>
          </ul>
        </nav>

        <!-- Container Fluid-->
        <div class="container-fluid" id="container-wrapper">
          <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Giáo trình đang theo dõi</h1>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="dashboard.html">Home</a></li>
              <li class="breadcrumb-item active">Giáo trình theo dõi</li>
            </ol>
          </div>

          <!-- Statistics -->
          <div class="row mb-4">
            <div class="col-md-4">
              <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Tổng số theo dõi</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">8</div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-star fa-2x text-warning"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Có cập nhật mới</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">3</div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-bell fa-2x text-success"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Chưa cập nhật</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">5</div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-clock fa-2x text-info"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Subscribed Syllabuses -->
          <div class="row">
            <!-- Syllabus Card 1 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
                  <h6 class="m-0 font-weight-bold">CS301</h6>
                  <span class="badge badge-light">
                    <i class="fas fa-bell"></i> Có cập nhật
                  </span>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Cơ sở dữ liệu</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> TS. Nguyễn Văn A<br>
                    <i class="fas fa-book"></i> 3 tín chỉ | Học kỳ 4<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 28/12/2025
                  </p>
                  <div class="alert alert-success py-2">
                    <small><i class="fas fa-check-circle"></i> Đã cập nhật nội dung mới</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS301" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS301')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>

            <!-- Syllabus Card 2 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
                  <h6 class="m-0 font-weight-bold">CS201</h6>
                  <span class="badge badge-light">
                    <i class="fas fa-bell"></i> Có cập nhật
                  </span>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Cấu trúc dữ liệu và giải thuật</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> TS. Lê Văn C<br>
                    <i class="fas fa-book"></i> 4 tín chỉ | Học kỳ 3<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 26/12/2025
                  </p>
                  <div class="alert alert-success py-2">
                    <small><i class="fas fa-check-circle"></i> Đã cập nhật đánh giá CLO</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS201" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS201')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>

            <!-- Syllabus Card 3 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
                  <h6 class="m-0 font-weight-bold">CS303</h6>
                  <span class="badge badge-light">
                    <i class="fas fa-bell"></i> Có cập nhật
                  </span>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Mạng máy tính</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> TS. Hoàng Thị E<br>
                    <i class="fas fa-book"></i> 3 tín chỉ | Học kỳ 5<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 24/12/2025
                  </p>
                  <div class="alert alert-success py-2">
                    <small><i class="fas fa-check-circle"></i> Thêm tài liệu tham khảo</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS303" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS303')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>

            <!-- Syllabus Card 4 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-secondary text-white">
                  <h6 class="m-0 font-weight-bold">CS101</h6>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Nhập môn lập trình</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> TS. Nguyễn Văn A<br>
                    <i class="fas fa-book"></i> 3 tín chỉ | Học kỳ 1<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 15/11/2025
                  </p>
                  <div class="alert alert-secondary py-2">
                    <small><i class="fas fa-clock"></i> Chưa có cập nhật mới</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS101" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS101')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>

            <!-- Syllabus Card 5 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-secondary text-white">
                  <h6 class="m-0 font-weight-bold">CS102</h6>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Lập trình hướng đối tượng</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> ThS. Phạm Văn D<br>
                    <i class="fas fa-book"></i> 3 tín chỉ | Học kỳ 2<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 10/11/2025
                  </p>
                  <div class="alert alert-secondary py-2">
                    <small><i class="fas fa-clock"></i> Chưa có cập nhật mới</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS102" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS102')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>

            <!-- Syllabus Card 6 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-secondary text-white">
                  <h6 class="m-0 font-weight-bold">CS302</h6>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Hệ điều hành</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> TS. Trần Thị B<br>
                    <i class="fas fa-book"></i> 3 tín chỉ | Học kỳ 4<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 05/11/2025
                  </p>
                  <div class="alert alert-secondary py-2">
                    <small><i class="fas fa-clock"></i> Chưa có cập nhật mới</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS302" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS302')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>

            <!-- Syllabus Card 7 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-secondary text-white">
                  <h6 class="m-0 font-weight-bold">CS401</h6>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Trí tuệ nhân tạo</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> TS. Trần Thị B<br>
                    <i class="fas fa-book"></i> 4 tín chỉ | Học kỳ 6<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 01/11/2025
                  </p>
                  <div class="alert alert-secondary py-2">
                    <small><i class="fas fa-clock"></i> Chưa có cập nhật mới</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS401" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS401')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>

            <!-- Syllabus Card 8 -->
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow h-100">
                <div class="card-header bg-secondary text-white">
                  <h6 class="m-0 font-weight-bold">CS402</h6>
                </div>
                <div class="card-body">
                  <h5 class="card-title">Học máy</h5>
                  <p class="card-text text-muted">
                    <i class="fas fa-user"></i> TS. Lê Văn C<br>
                    <i class="fas fa-book"></i> 4 tín chỉ | Học kỳ 7<br>
                    <i class="fas fa-calendar"></i> Cập nhật: 28/10/2025
                  </p>
                  <div class="alert alert-secondary py-2">
                    <small><i class="fas fa-clock"></i> Chưa có cập nhật mới</small>
                  </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                  <a href="syllabus-detail.html?id=CS402" class="btn btn-sm btn-primary">
                    <i class="fas fa-eye"></i> Xem chi tiết
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="unsubscribe('CS402')">
                    <i class="fas fa-star"></i> Bỏ theo dõi
                  </button>
                </div>
              </div>
            </div>
          <div class="row" id="syllabusContainer">
          </div>

        </div>
      </div>
      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>copyright &copy; <script> document.write(new Date().getFullYear()); </script> - SMD System</span>
          </div>
        </div>
      </footer>
    </div>
  </div>

  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
  <script src="js/ruang-admin.min.js"></script>

  <script>
    const API_BASE_URL = 'http://localhost:8000';

// Store all syllabus data
    const allSyllabuses = [
      { id: 'CS101', name: 'Nhập môn lập trình', credits: 3, lecturer: 'TS. Nguyễn Văn A', semester: 1, updated: false },
      { id: 'CS102', name: 'Lập trình hướng đối tượng', credits: 3, lecturer: 'ThS. Phạm Văn D', semester: 2, updated: false },
      { id: 'CS201', name: 'Cấu trúc dữ liệu và giải thuật', credits: 4, lecturer: 'TS. Lê Văn C', semester: 3, updated: true },
      { id: 'CS301', name: 'Cơ sở dữ liệu', credits: 3, lecturer: 'TS. Nguyễn Văn A', semester: 4, updated: true },
      { id: 'CS302', name: 'Hệ điều hành', credits: 3, lecturer: 'TS. Trần Thị B', semester: 4, updated: false },
      { id: 'CS303', name: 'Mạng máy tính', credits: 3, lecturer: 'TS. Hoàng Thị E', semester: 5, updated: true },
      { id: 'CS401', name: 'Trí tuệ nhân tạo', credits: 4, lecturer: 'TS. Trần Thị B', semester: 6, updated: false },
      { id: 'CS402', name: 'Học máy', credits: 4, lecturer: 'TS. Lê Văn C', semester: 7, updated: false },
      { id: 'SE101', name: 'Kiến trúc phần mềm', credits: 3, lecturer: 'TS. Hoàng Văn F', semester: 1, updated: false },
      { id: 'SE201', name: 'Testing và QA', credits: 3, lecturer: 'ThS. Tạ Văn G', semester: 3, updated: false },
      { id: 'IT101', name: 'Hệ thống thông tin', credits: 3, lecturer: 'TS. Vũ Thị H', semester: 1, updated: false },
      { id: 'IT201', name: 'Quản lý hệ thống', credits: 3, lecturer: 'TS. Phạm Thị I', semester: 3, updated: false },
    ];

    let subscriptions = new Set();

    function renderSubscribedSyllabuses() {
      const container = $('#syllabusContainer');
      container.empty();

      if (subscriptions.size === 0) {
        updateStatistics();
        return;
      }

      const subscribedSyllabuses = allSyllabuses.filter(s => subscriptions.has(s.id));

      subscribedSyllabuses.forEach(syllabus => {
        const headerClass = syllabus.updated ? 'bg-warning' : 'bg-secondary';
        const updateBadge = syllabus.updated ? `<span class="badge badge-light"><i class="fas fa-bell"></i> Có cập nhật</span>` : '';
        const alertClass = syllabus.updated ? 'alert-success' : 'alert-secondary';
        const alertIcon = syllabus.updated ? '<i class="fas fa-check-circle"></i> Đã cập nhật nội dung mới' : '<i class="fas fa-clock"></i> Chưa có cập nhật mới';
        
        const card = `
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card shadow h-100">
              <div class="card-header ${headerClass} text-white d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold">${syllabus.id}</h6>
                ${updateBadge}
              </div>
              <div class="card-body">
                <h5 class="card-title">${syllabus.name}</h5>
                <p class="card-text text-muted">
                  <i class="fas fa-user"></i> ${syllabus.lecturer}<br>
                  <i class="fas fa-book"></i> ${syllabus.credits} tín chỉ | Học kỳ ${syllabus.semester}<br>
                </p>
                <div class="alert ${alertClass} py-2">
                  <small>${alertIcon}</small>
                </div>
              </div>
              <div class="card-footer d-flex justify-content-between">
                <a href="syllabus-detail.html?id=${syllabus.id}" class="btn btn-sm btn-primary">
                  <i class="fas fa-eye"></i> Xem chi tiết
                </a>
                <button class="btn btn-sm btn-danger" onclick="unsubscribe('${syllabus.id}')">
                  <i class="fas fa-star"></i> Bỏ theo dõi
                </button>
              </div>
            </div>
          </div>
        `;
        container.append(card);
      });

      updateStatistics();
    }

    function updateStatistics() {
      const subscribed = allSyllabuses.filter(s => subscriptions.has(s.id));
      const updated = subscribed.filter(s => s.updated).length;
      const notUpdated = subscribed.length - updated;

      $('#totalCount').text(subscribed.length);
      $('#updatedCount').text(updated);
      $('#notUpdatedCount').text(notUpdated);
    }

    function loadSubscriptions() {
      const saved = localStorage.getItem('subscriptions');
      if (saved) {
        subscriptions = new Set(JSON.parse(saved));
      }
      renderSubscribedSyllabuses();
    }

    async function checkAuth() {
      const token = localStorage.getItem('access_token');
      if (!token) {
        window.location.href = '/index.html';
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/users/me`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (response.ok) {
          const user = await response.json();
          if (user.role !== 'student') {
            alert('Bạn không có quyền truy cập!');
            window.location.href = '/index.html';
            return;
          }
          document.getElementById('userFullName').textContent = user.full_name || 'Student';
        } else {
          localStorage.removeItem('access_token');
          window.location.href = '/index.html';
        }
      } catch (error) {
        console.error('Auth error:', error);
      }
    }

    function handleLogout() {
      if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
        localStorage.removeItem('access_token');
        window.location.href = '/index.html';
      }
    }

    function unsubscribe(subjectCode) {
      if (confirm(`Bỏ theo dõi môn ${subjectCode}?`)) {
subscriptions.delete(subjectCode);
        localStorage.setItem('subscriptions', JSON.stringify(Array.from(subscriptions)));
        renderSubscribedSyllabuses();
        alert('Đã bỏ theo dõi thành công!');
      }
    }

    $(document).ready(function() {
      checkAuth();
loadSubscriptions();
    });
  </script>
</body>

</html>
